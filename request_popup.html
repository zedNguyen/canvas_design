<!DOCTYPE html>
<html lang="ko">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>Popup Request</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />

  <meta name="robots" content="noindex,nofollow" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Global site tag (gtag.js) - Google Analytics PROD만 동작 -->

  <link href="./저장위치 관리_files/bootstrap.min.css" rel="stylesheet" />
  <link href="./저장위치 관리_files/perfect-scrollbar.min.css" rel="stylesheet" />

  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />

  <link href="./저장위치 관리_files/jquery.bootstrap-touchspin.min.css" rel="stylesheet" />

  <link href="./저장위치 관리_files/style.css" rel="stylesheet" />
  <link href="./저장위치 관리_files/jquery-ui.min.css" rel="stylesheet" />

  <link rel="stylesheet" href="./저장위치 관리_files/pinejs.css" />

  <link href="./저장위치 관리_files/ag-grid.min.css" rel="stylesheet" />
  <link href="./저장위치 관리_files/ag-theme-balham.min.css" rel="stylesheet" />
  <link href="./저장위치 관리_files/aggrid.css" rel="stylesheet" />

  <link href="./저장위치 관리_files/toastr.css" rel="stylesheet" />

  <link href="./저장위치 관리_files/blue.css" id="theme" rel="stylesheet" />

  <!-- Harmony Blue & custom styles for /learn pages -->
  <link href="./style.css" rel="stylesheet" />
  <link href="./저장위치 관리_files/custom.css" rel="stylesheet" />

  <script src="./저장위치 관리_files/jquery.min.js.download"></script>

  <script src="./저장위치 관리_files/popper.min.js.download"></script>
  <script src="./저장위치 관리_files/bootstrap.min.js.download"></script>

  <script src="./저장위치 관리_files/perfect-scrollbar.jquery.min.js.download"></script>

  <script src="./저장위치 관리_files/waves.js.download"></script>

  <script src="./저장위치 관리_files/sidebarmenu.js.download"></script>
  <!-- <script th:src="@{/plugins/pinejs/js/adminpro.js}"></script> -->

  <script src="./저장위치 관리_files/adminpro.js.download"></script>

  <script src="./저장위치 관리_files/jquery.toast.js.download"></script>

  <script src="./저장위치 관리_files/jquery.serializeObject.min.js.download"></script>

  <script src="./저장위치 관리_files/jquery.validate.min.js.download"></script>
  <script src="./저장위치 관리_files/messages_ko.js.download"></script>

  <script src="./저장위치 관리_files/jquery-ui.min.js.download"></script>
  <script src="./저장위치 관리_files/numeral.min.js.download"></script>
  <script src="./저장위치 관리_files/lodash.4.17.15.min.js.download"></script>
  <script src="./저장위치 관리_files/moment.js.download"></script>

  <script src="./저장위치 관리_files/jquery.collapse.js.download"></script>

  <script src="./저장위치 관리_files/jquery.bootstrap-touchspin.min.js.download"></script>
  <!-- bootstrap submodal -->
  <script src="./저장위치 관리_files/bs.sm.js.download"></script>

  <script src="./저장위치 관리_files/xlsx.full.min.js.download"></script>
  <script src="./저장위치 관리_files/fileSaver.min.js.download"></script>
  <script src="./저장위치 관리_files/toastr.min.js.download"></script>

  <script src="./저장위치 관리_files/jquery.mask.js.download"></script>

  <script src="./저장위치 관리_files/ag-grid-enterprise.min.noStyle.js.download"></script>
  <script>
    agGrid.LicenseManager.setLicenseKey(
      "CompanyName=JSIT,LicensedGroup=HANSOL PNS IT-SERVICE,LicenseType=MultipleApplications,LicensedConcurrentDeveloperCount=3,LicensedProductionInstancesCount=2,AssetReference=AG-008218,ExpiryDate=21_May_2021_[v2]_MTYyMTU1MTYwMDAwMA==fb098f15da774457685846b99c4a3a7e"
    );
  </script>
  <script src="./저장위치 관리_files/ag_base.js.download"></script>
  <script src="./저장위치 관리_files/ag_locale_ko.js.download"></script>
  <script src="./저장위치 관리_files/ag_renderer.js.download"></script>
  <script src="./저장위치 관리_files/ag_formatter.js.download"></script>
  <script src="./저장위치 관리_files/ag_editor.js.download"></script>
  <script src="./저장위치 관리_files/ag_excel.js.download"></script>

  <!-- CK Editor -->
  <!-- ============================================================== -->
  <script src="./저장위치 관리_files/ckeditor.js.download"></script>
  <style>
    .cke {
      visibility: hidden;
    }
  </style>

  <script src="./저장위치 관리_files/pine.js.download"></script>
  <script src="./저장위치 관리_files/global-val.js.download"></script>
  <script src="./저장위치 관리_files/core.js.download"></script>
  <script src="./저장위치 관리_files/file.js.download"></script>
  <script src="./저장위치 관리_files/auth.js.download"></script>
  <script src="./저장위치 관리_files/editor.js.download"></script>
  <script src="./저장위치 관리_files/aggridHelper.js.download"></script>

  <!-- ============================================================== -->

  <script src="./저장위치 관리_files/doc_ready.js.download"></script>
</head>

<body class="fix-header card-no-border main">
  <div class="preloader" style="display: none">
    <div class="loader">
      <div class="loader__figure"></div>
      <p class="loader__label">Harmony</p>
    </div>
  </div>

  <div id="main-wrapper">
    <header class="topbar">
      <nav class="navbar top-navbar navbar-expand-md navbar-light">
        <div class="navbar-header">
          <a class="navbar-brand">
            <b>
              <img src="./저장위치 관리_files/logo-icon.png" alt="homepage" class="dark-logo" />

              <img src="./저장위치 관리_files/logo-light-icon.png" alt="homepage" class="light-logo" />
            </b>

            <span>
              <img src="./저장위치 관리_files/logo-text.png" alt="homepage" class="dark-logo" />

              <img src="./저장위치 관리_files/logo-light-text.png" class="light-logo" alt="homepage" /></span>
          </a>
        </div>

        <div class="navbar-collapse">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item">
              <a class="nav-link nav-toggler hidden-md-up waves-effect waves-dark" href="javascript:void(0)"><i
                  class="ti-menu"></i></a>
            </li>
            <li class="nav-item">
              <a class="nav-link sidebartoggler hidden-sm-down waves-effect waves-dark" href="javascript:void(0)"><i
                  class="fa-solid fa-bars"></i></a>
            </li>
          </ul>

          <ul class="navbar-nav my-lg-0">
            <li class="nav-item">
              <a class="nav-link" href="javascript:void(0)">
                <span style="font-weight: bold; font-size: 18px">dev서버</span>
              </a>
            </li>

            <li class="nav-item hidden-xs-down search-box">
              <a class="nav-link hidden-sm-down waves-effect waves-dark" href="javascript:void(0)" title="메뉴 검색"><i
                  class="ti-search"></i></a>
              <form class="app-search" onsubmit="return false">
                <input type="text" id="menu-search-txt" class="form-control" placeholder="메뉴 검색" />
                <a class="srh-btn"><i class="ti-close"></i></a>
                <div id="menu-search" class="search-rslt"></div>
              </form>
            </li>

            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle waves-effect waves-dark" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false">
                <span>시스템관리</span>
              </a>
              <div class="dropdown-menu dropdown-menu-right animated flipInY">
                <ul class="dropdown-user">
                  <li>
                    <div class="dw-user-box">
                      <div class="u-text">
                        <h4>
                          <i class="fas fa-user"></i>&nbsp;
                          <span>시스템관리</span>
                        </h4>
                        <p class="text-muted"><span></span></p>
                      </div>
                    </div>
                  </li>
                  <li role="separator" class="divider"></li>
                  <li>
                    <a><i class="ti-settings"></i> 계정설정</a>
                  </li>
                  <li role="separator" class="divider"></li>
                  <li>
                    <a><i class="fa fa-power-off"></i> 로그아웃</a>
                  </li>
                </ul>
              </div>
            </li>
          </ul>
        </div>
      </nav>
    </header>
    <aside class="left-sidebar">
      <div class="scroll-sidebar ps-container ps-theme-default" data-ps-id="6445c0c0-d75d-a3cd-4fab-49cc73438c65">
        <nav class="sidebar-nav active">
          <ul id="sidebarnav" class="in">
            <li class="nav-small-cap">즐겨찾기 ★</li>
            <ul class="list-group" id="sidebarnav-favorite"></ul>
            <li class="nav-devider"></li>

            <li class="nav-small-cap">프로그램</li>

            <li class="active">
              <a class="has-arrow waves-effect waves-dark" aria-expanded="true">
                <i class="mdi mdi-format-list-bulleted"></i>
                <span class="hide-menu">Request</span>
              </a>

              <ul aria-expanded="true" class="collapse in show">
                <li style="margin-left: 14px;">
                  <a class=" waves-effect waves-dark" href="./request_popup.html" style="color: #007bff;">Popup Request
                    Demo</a>
                </li>
                <li style="margin-left: 14px;">
                  <a class=" waves-effect waves-dark" href="./request_listing.html">Request listing Demo</a>
                </li>

              </ul>
            </li>
          </ul>
        </nav>
        <div class="ps-scrollbar-x-rail" style="left: 0px; bottom: 0px">
          <div class="ps-scrollbar-x" tabindex="0" style="left: 0px; width: 0px"></div>
        </div>
        <div class="ps-scrollbar-y-rail" style="top: 0px; right: 3px">
          <div class="ps-scrollbar-y" tabindex="0" style="top: 0px; height: 0px"></div>
        </div>
      </div>
    </aside>

    <div class="page-wrapper" style="min-height: 952px">
      <div class="container-fluid r-aside">
        <div class="row page-titles m-b-10">
          <div class="col-md-5 align-self-center">
            <!-- <h4 class="text-themecolor"><i class="fas fa-sticky-note pageIcon"></i><span id="pageTitles">HOME</span></h3> -->
            <!-- <h6 class="text-themecolor" id="pageTitleText">HOME</h5> -->
            <li id="pageTitleText">
              Popup Request Demo<i class="fa-regular fa-star" style="
                    font-size: 16px !important;
                    font-weight: bold !important;
                    margin-left: 5px;
                  " data-favo="N"></i>
            </li>
          </div>
        </div>

        <div class="toolbar">
          <div class="toolbar-right">
            <button id="btn-new" class="btn btn-harmony-blue btn-sm">
              <i class="fa fa-plus"></i> Request
            </button>

          </div>
          <div class="after-floatright"></div>
        </div>

        <!-- SECTION Filter collapse -->
        <div class="card" style="margin-bottom: 0px;" data-collapse="">
          <div class="card-header field-header open" data-collapse-summary="" aria-expanded="true">
            <a>
              <a class="card-link" aria-expanded="true" aria-controls="cardBody">검색조건
                <span class="expanded">
                  <p><b>▼</b></p>
                </span>
              </a>
            </a>
          </div>
          <div id="cardBody" class="collapse show field-body" aria-hidden="false">
            <div class="card-body">
            </div>
          </div>
        </div>

        <div class="learn-quickfilter d-flex justify-content-between align-items-center mb-1"
          style="background: #f7f9fb; padding: 5px 0; border-radius: 8px">
        </div>

        <!-- Table Here -->


        <!-- Second filter -->



      </div>


      <!-- End fixed bottom info bar -->

      <footer class="footer text-center">© 2025 Harmony by HansolPNS</footer>
    </div>
    <!-- Fixed bottom info bar -->

  </div> <!-- page-wrapper -->
  </div> <!-- main-wrapper -->

  <input type="hidden" id="spring_profile" value="dev" />
  <input type="hidden" id="loginUserId" value="marusys" />
  <input type="hidden" id="session_USER_ID" value="marusys" />
  <input type="hidden" id="session_USER_NM" value="시스템관리" />
  <input type="hidden" id="session_MANDT" value="100" />
  <input type="hidden" id="session_MANDT_NM" value="지류유통" />
  <input type="hidden" id="session_BUKRS" value="M200" />
  <input type="hidden" id="session_BUKRS_NM" value="PNS지류유통" />
  <input type="hidden" id="session_VKGRP" value="" />
  <input type="hidden" id="session_VKGRP_NM" value="" />
  <input type="hidden" id="session_MOBILE" value="" />
  <input type="hidden" id="session_EMAIL" value="" />
  <input type="hidden" id="session_KOSTL" value="" />
  <input type="hidden" id="session_ADMIN_YN" value="N" />
  <input type="hidden" id="session_LOGIN_DT" value="2025-07-15 19:30:24" />
  <input type="hidden" id="session_SMART_ID" value="" />
  <input type="hidden" id="session_SMART_PASSWORD" value="" />
  <input type="hidden" id="session_USER_IP" value="0:0:0:0:0:0:0:1" />
  <input type="hidden" id="session_SESSION_ID" value="" />
  <input type="hidden" id="session_FIRST_TOPMENU" value="" />
  <input type="hidden" id="session_MM" value="MM999" />
  <input type="hidden" id="session_SD" value="SD999" />
  <input type="hidden" id="session_CO" value="CO999" />
  <input type="hidden" id="session_FI" value="FI999" />
  <input type="hidden" id="session_CM" value="CM999" />
  <input type="hidden" id="session_IN_IP_YN" value="N" />
  <input type="hidden" id="session_UPPER_BU" value="" />
  <input type="hidden" id="session_UPPER_NAME" value="" />

  <input id="message" type="hidden" value="" />

  <!-- Modal Request Popup -->
  <div class="modal fade" id="requestModal" tabindex="-1" role="dialog" aria-labelledby="requestModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
      <form id="requestForm" class="modal-content" style="border-radius: 16px; overflow: hidden;">
        <div class="modal-header" style="border-bottom: 1px solid #f0f0f0;">
          <h5 class="modal-title" id="requestModalLabel"><i class="fa fa-paper-plane"></i> 새 요청 생성</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" style="background: #f7f9fb;">


          <div
            style="background: #fff; border-radius: 12px; box-shadow: 0 2px 8px #0001; padding: 24px 24px 12px 24px;">
            <!-- 결재자 -->
            <div class="row" style="margin-bottom: 18px;">
              <div class="col-md-4" style="padding: 0 12px; border-right: 1px solid #e3e7ed; text-align: center;">
                <div style="font-size:15px;color:#222;text-align: left; font-weight: bold ;">요청자</div>
                <div
                  style="width: 64px; height: 64px; margin: 0 auto 12px; background: #e3e7ed; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; font-weight: bold; color: #4a5568;">
                  <span id="userAvatar">AV</span>
                </div>
                <div style="font-size: 18px; font-weight: bold; color: #222;" id="userName">김철수</div>
                <div style="font-size: 14px; color: #888; margin-bottom: 8px;" id="userOrg">홍길동</div>
                <div style="font-size: 13px; color: #666;">조직: <span id="userDept">웹팀</span></div>
                <div style="font-size: 13px; color: #666; margin-top: 4px;">요청일: <span id="userDate">2025/07/21</span>
                </div>

              </div>
              <div class="col-md-8">
                <div style="margin-bottom: 18px;">
                  <div style="font-weight: bold; font-size: 15px; color: #222; margin-bottom: 6px;">결재자</div>
                  <div style="display: flex; align-items: center; flex-wrap: wrap; gap: 8px; margin-bottom: 8px;">
                    <div id="approverList" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
                    <button class="btn btn-light btn-sm" type="button" id="showApproverSelect"
                      style="border-radius:50%;width:32px;height:32px;display:flex;align-items:center;justify-content:center;"><i
                        class="fa fa-plus" style="color:#2563eb;"></i></button>
                    <div id="approverSelectWrap" style="display:none;min-width:180px;">
                      <div class="input-group mb-2" style="max-width: 220px;">
                        <select class="form-control form-control-sm" id="approverSelect">
                          <option value="">결재자 선택</option>
                          <option value="박민수">박민수</option>
                          <option value="이영희">이영희</option>
                          <option value="최지훈">최지훈</option>
                        </select>
                        <div class="input-group-append">
                          <button class="btn btn-primary btn-sm" type="button" id="addApprover">확인</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- 참조자 -->
                <div style="margin-bottom: 18px;">
                  <div style="font-weight: bold; font-size: 15px; color: #222; margin-bottom: 6px;">참조자</div>
                  <div style="display: flex; align-items: center; flex-wrap: wrap; gap: 8px; margin-bottom: 8px;">
                    <div id="ccList" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
                    <button class="btn btn-light btn-sm" type="button" id="showCCSelect"
                      style="border-radius:50%;width:32px;height:32px;display:flex;align-items:center;justify-content:center;"><i
                        class="fa fa-plus" style="color:#a259e6;"></i></button>
                    <div id="ccSelectWrap" style="display:none;min-width:180px;">
                      <div class="input-group mb-2" style="max-width: 220px;">
                        <select class="form-control form-control-sm" id="ccSelect">
                          <option value="">참조자 선택</option>
                          <option value="김영수">김영수</option>
                          <option value="박지은">박지은</option>
                          <option value="정우성">정우성</option>
                        </select>
                        <div class="input-group-append">
                          <button class="btn btn-purple btn-sm" type="button" id="addCC">확인</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

              </div>
            </div>

            <!-- 제목, 내용, 우선순위, 부서, 첨부파일 -->
            <div class="form-group">
              <label for="title" style="font-size: 14px; font-weight: bold;">제목 <span style="color:red">*</span></label>
              <input type="text" class="form-control form-control-sm" id="title" name="title" placeholder="요청 제목을 입력하세요"
                required>
            </div>
            <div class="form-group">
              <label for="content" style="font-size: 14px; font-weight: bold;">내용 <span
                  style="color:red">*</span></label>
              <textarea class="form-control form-control-sm" id="content" name="content" rows="3"
                placeholder="요청 내용을 입력하세요" required></textarea>
            </div>
            <div class="form-row mb-2">
              <div class="form-group col-md-6">
                <label for="priority" style="font-size: 14px; font-weight: bold;">우선순위</label>
                <select class="form-control form-control-sm" id="priority" name="priority">
                  <option value="낮음">낮음</option>
                  <option value="보통">보통</option>
                  <option value="높음">높음</option>
                </select>
              </div>
              <div class="form-group col-md-6">
                <label for="department" style="font-size: 14px; font-weight: bold;">부서</label>
                <input type="text" class="form-control form-control-sm" id="department" name="department"
                  placeholder="관련 부서를 입력하세요">
              </div>
            </div>
            <!-- 첨부파일 (드래그 앤 드롭 유지) -->
            <div class="form-group">
              <label for="attachment" style="font-size: 14px; font-weight: bold;">첨부파일</label>
              <div id="drop-area"
                style="border: 2px dashed #bdbdbd; border-radius: 12px; background: #fff; padding: 32px 0; text-align: center; margin-top: 8px; margin-bottom: 8px; cursor: pointer; transition: border-color 0.2s;">
                <span style="font-size: 16px; color: #444;">여기로 파일을 끌어다 놓거나 <span id="browseFile"
                    style="color: #2563eb; text-decoration: underline; cursor: pointer;">파일 선택</span></span>
                <div style="font-size: 12px; color: #888; margin-top: 8px;">최대 크기: 5MB (PDF, DOCX, XLSX, JPG, PNG 지원)
                </div>
                <input type="file" id="attachment" name="attachment" style="display: none;"
                  accept=".pdf,.docx,.xlsx,.jpg,.jpeg,.png" />
                <div id="fileName" style="margin-top: 10px; font-size: 14px; color: #2563eb;"></div>
              </div>
            </div>
          </div>

        </div>
        <div class="modal-footer" style="border-top: 1px solid #f0f0f0;">
          <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">닫기</button>
          <button type="submit" class="btn btn-harmony-blue btn-sm"><i class="fa fa-paper-plane"></i> 요청 보내기</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    $(document).ready(function () {
      // Lấy tên người đề nghị từ session
      $('#requester').val($('#session_USER_NM').val() || '');
      // Set ngày hiện tại cho ngày yêu cầu
      $('#requestDate').val(new Date().toISOString().slice(0, 10));
      // Mở popup khi bấm nút Request
      $('#btn-new').on('click', function () {
        $('#requestModal').modal('show');
      });
      // Validate và submit form
      $('#requestForm').on('submit', function (e) {
        e.preventDefault();
        if (!$('#title').val() || !$('#content').val()) {
          toastr.warning('Vui lòng nhập đầy đủ thông tin bắt buộc!');
          return;
        }
        toastr.success('Yêu cầu đã được gửi!');
        $('#requestModal').modal('hide');
        this.reset();
        $('#requester').val($('#session_USER_NM').val() || '');
        $('#requestDate').val(new Date().toISOString().slice(0, 10));
      });
    });
  </script>
  <!-- 타임리프 사용을 위해서 th:inline="javascript" -->
  <script>
  </script>
  <script>
    // Column definitions for production grid (tái sử dụng)
    const productionColumnDefs = [
      { headerName: "출력선택", field: "print_select", width: 90, checkboxSelection: true, headerCheckboxSelection: true },
      { headerName: "생산일자", field: "prod_date", width: 110 },
      { headerName: "작업순서", field: "work_order", width: 90 },
      { headerName: "호기", field: "machine_no", width: 70 },
      { headerName: "생태", field: "prod_type", width: 70 },
      { headerName: "판매처", field: "seller", width: 110 },
      { headerName: "납품처", field: "buyer", width: 110 },
      { headerName: "납기일자", field: "due_date", width: 110 },
      { headerName: "납기시간", field: "due_time", width: 90 },
      { headerName: "영업오더", field: "sales_order", width: 110 },
      { headerName: "작업유형", field: "job_type", width: 90 },
      { headerName: "생산오더", field: "prod_order", width: 110 },
      { headerName: "재단구분", field: "cut_type", width: 90 },
      { headerName: "FSC", field: "fsc", width: 60 },
      { headerName: "투입지종", field: "input_paper", width: 90 },
      { headerName: "투입평량", field: "input_weight", width: 90 },
      { headerName: "투입가로", field: "input_width", width: 90 },
      { headerName: "투입세로", field: "input_height", width: 90 },
      { headerName: "투입인치", field: "input_inch", width: 90 },
      { headerName: "계획 폭", field: "plan_width", width: 90 },
      { headerName: "계획 가로", field: "plan_garo", width: 90 },
      { headerName: "계획 세로", field: "plan_sero", width: 90 },
      { headerName: "계획 수량( R )", field: "plan_qty_r", width: 110 },
      { headerName: "계획 중량 (Kg)", field: "plan_weight_kg", width: 120 },
      { headerName: "투입 롤수", field: "input_roll_cnt", width: 90 },
      { headerName: "기계 속도", field: "machine_speed", width: 90 },
      { headerName: "작업시간(분)", field: "work_time_min", width: 110 },
      { headerName: "소요 길이", field: "need_length", width: 90 },
      { headerName: "소요 (분)", field: "need_min", width: 90 },
      { headerName: "중지(분)", field: "stop_min", width: 90 },
      { headerName: "중지사유", field: "stop_reason", width: 110 },
      { headerName: "CUT (정매)", field: "cut_main", width: 90 },
      { headerName: "CUT (여분)", field: "cut_extra", width: 90 },
      { headerName: "PT", field: "pt", width: 60 },
      { headerName: "생산지시 선택", field: "prod_select", width: 110 },
      { headerName: "확정 처리", field: "confirm_proc", width: 90 },
      { headerName: "삭제 처리", field: "delete_proc", width: 90 },
      { headerName: "비고 (생산유의사항)", field: "note_prod", width: 160 },
      { headerName: "비고2 (포장유의사항)", field: "note_pack", width: 160 },
      { headerName: "전달 사항", field: "note_transfer", width: 120 }
    ];

    // Grid options for production grid
    const productionGridOptions = {
      columnDefs: productionColumnDefs,
      rowSelection: 'multiple',
      defaultColDef: {
        resizable: true,
        sortable: true,
        filter: true,
        minWidth: 60
      },
      suppressRowClickSelection: false,
      animateRows: true,
      rowData: [
        {
          print_select: false,
          prod_date: "2025-07-10",
          work_order: "1",
          machine_no: "1호기",
          prod_type: "일반",
          seller: "한솔PNS",
          buyer: "고객A",
          due_date: "2025-07-14",
          due_time: "14:00",
          sales_order: "SO123456",
          job_type: "절단",
          prod_order: "PO987654",
          cut_type: "정매",
          fsc: "Y",
          input_paper: "백상지",
          input_weight: "80",
          input_width: "1000",
          input_height: "1200",
          input_inch: "39.4",
          plan_width: "1000",
          plan_garo: "1000",
          plan_sero: "1200",
          plan_qty_r: "10",
          plan_weight_kg: "800",
          input_roll_cnt: "2",
          machine_speed: "150",
          work_time_min: "60",
          need_length: "1500",
          need_min: "60",
          stop_min: "0",
          stop_reason: "",
          cut_main: "10",
          cut_extra: "1",
          pt: "PT1",
          prod_select: false,
          confirm_proc: "N",
          delete_proc: "N",
          note_prod: "주의사항 없음",
          note_pack: "포장 주의",
          note_transfer: "전달사항 없음"
        }
      ] // Dữ liệu sẽ được load động
    };

    // Khởi tạo grid khi DOM ready
    document.addEventListener('DOMContentLoaded', function () {
      new agGrid.Grid(document.getElementById('productionGrid'), productionGridOptions);
    });
  </script>
  <script>
    $(function () {
      var path = window.location.pathname;
      $('#sidebarnav a[href="' + path + '"]').each(function () {
        $(this).parent('li').addClass('active');
        $(this).closest('ul').addClass('in show').attr('aria-expanded', 'true');
        $(this).closest('li').addClass('active');
        $(this).attr('aria-expanded', 'true');
      });
    });
  </script>
  <script>
    // Set user info (avatar, name, org, date)
    function getInitials(name) {
      return name.split(' ').map(w => w[0]).join('').toUpperCase();
    }
    const userName = $('#session_USER_NM').val() || 'Nguyễn Hữu Quang';
    const userOrg = 'Joey Nguyen'; // Có thể lấy từ session nếu có
    const userDept = 'Web'; // Có thể lấy từ session nếu có
    const userDate = new Date().toISOString().slice(0, 10);
    $('#userAvatar').text(getInitials(userName));
    $('#userName').text(userName);
    $('#userOrg').text(userOrg);
    $('#userDept').text(userDept);
    $('#userDate').text(userDate.replace(/-/g, '/'));

    // Approver logic
    let approvers = ["박민수", "이영희"]; // 기본 결재자
    function renderApprovers() {
      $('#approverList').html(approvers.map((name, idx) =>
        `<div style="display:flex;align-items:center;background:#f0f4fa;border-radius:20px;padding:4px 12px 4px 6px;box-shadow:0 1px 4px #0001;gap:7px;">
      <div style='width:28px;height:28px;border-radius:50%;background:#2563eb22;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:14px;color:#2563eb;'><i class='fa fa-user'></i></div>
      <span style='font-size:14px;color:#222;'>${name}</span>
      <span style='cursor:pointer;color:#f00;font-size:16px;margin-left:4px;' onclick='removeApprover(${idx})' title='삭제'><i class='fa fa-times-circle'></i></span>
    </div>`
      ).join(''));
    }
    window.removeApprover = function (idx) {
      approvers.splice(idx, 1);
      renderApprovers();
    }
    // Approver select show/hide logic
    $('#showApproverSelect').on('click', function () {
      $('#approverSelectWrap').show();
      $('#approverSelect').focus();
    });
    $('#addApprover').on('click', function () {
      const val = $('#approverSelect').val();
      if (val && !approvers.includes(val)) {
        approvers.push(val);
        renderApprovers();
      }
      $('#approverSelectWrap').hide();
      $('#approverSelect').val('');
    });
    $(document).on('click', function (e) {
      if (!$(e.target).closest('#approverSelectWrap, #showApproverSelect').length) {
        $('#approverSelectWrap').hide();
      }
    });
    // CC logic
    let ccs = ["김영수", "박지은"]; // 기본 참조자
    function renderCCs() {
      $('#ccList').html(ccs.map((name, idx) =>
        `<div style="display:flex;align-items:center;background:#f6f0fa;border-radius:20px;padding:4px 12px 4px 6px;box-shadow:0 1px 4px #0001;gap:7px;">
      <div style='width:28px;height:28px;border-radius:50%;background:#a259e622;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:14px;color:#a259e6;'><i class='fa fa-user'></i></div>
      <span style='font-size:14px;color:#222;'>${name}</span>
      <span style='cursor:pointer;color:#f00;font-size:16px;margin-left:4px;' onclick='removeCC(${idx})' title='삭제'><i class='fa fa-times-circle'></i></span>
    </div>`
      ).join(''));
    }
    window.removeCC = function (idx) {
      ccs.splice(idx, 1);
      renderCCs();
    }
    // CC select show/hide logic
    $('#showCCSelect').on('click', function () {
      $('#ccSelectWrap').show();
      $('#ccSelect').focus();
    });
    $('#addCC').on('click', function () {
      const val = $('#ccSelect').val();
      if (val && !ccs.includes(val)) {
        ccs.push(val);
        renderCCs();
      }
      $('#ccSelectWrap').hide();
      $('#ccSelect').val('');
    });
    $(document).on('click', function (e) {
      if (!$(e.target).closest('#ccSelectWrap, #showCCSelect').length) {
        $('#ccSelectWrap').hide();
      }
    });
    // 기본 결재자/참조자 렌더링
    $(document).ready(function () {
      renderApprovers();
      renderCCs();
    });
  </script>
</body>

</html>