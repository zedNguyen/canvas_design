<!DOCTYPE html>
<html lang="ko">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>Popup Request</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />

  <meta name="robots" content="noindex,nofollow" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Global site tag (gtag.js) - Google Analytics PROD만 동작 -->

  <link href="./저장위치 관리_files/bootstrap.min.css" rel="stylesheet" />
  <link href="./저장위치 관리_files/perfect-scrollbar.min.css" rel="stylesheet" />

  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />

  <link href="./저장위치 관리_files/jquery.bootstrap-touchspin.min.css" rel="stylesheet" />

  <link href="./저장위치 관리_files/style.css" rel="stylesheet" />
  <link href="./저장위치 관리_files/jquery-ui.min.css" rel="stylesheet" />

  <link rel="stylesheet" href="./저장위치 관리_files/pinejs.css" />

  <link href="./저장위치 관리_files/ag-grid.min.css" rel="stylesheet" />
  <link href="./저장위치 관리_files/ag-theme-balham.min.css" rel="stylesheet" />
  <link href="./저장위치 관리_files/aggrid.css" rel="stylesheet" />

  <link href="./저장위치 관리_files/toastr.css" rel="stylesheet" />

  <link href="./저장위치 관리_files/blue.css" id="theme" rel="stylesheet" />

  <!-- Harmony Blue & custom styles for /learn pages -->
  <link href="./style.css" rel="stylesheet" />
  <link href="./저장위치 관리_files/custom.css" rel="stylesheet" />

  <script src="./저장위치 관리_files/jquery.min.js.download"></script>

  <script src="./저장위치 관리_files/popper.min.js.download"></script>
  <script src="./저장위치 관리_files/bootstrap.min.js.download"></script>

  <script src="./저장위치 관리_files/perfect-scrollbar.jquery.min.js.download"></script>

  <script src="./저장위치 관리_files/waves.js.download"></script>

  <script src="./저장위치 관리_files/sidebarmenu.js.download"></script>
  <!-- <script th:src="@{/plugins/pinejs/js/adminpro.js}"></script> -->

  <script src="./저장위치 관리_files/adminpro.js.download"></script>

  <script src="./저장위치 관리_files/jquery.toast.js.download"></script>

  <script src="./저장위치 관리_files/jquery.serializeObject.min.js.download"></script>

  <script src="./저장위치 관리_files/jquery.validate.min.js.download"></script>
  <script src="./저장위치 관리_files/messages_ko.js.download"></script>

  <script src="./저장위치 관리_files/jquery-ui.min.js.download"></script>
  <script src="./저장위치 관리_files/numeral.min.js.download"></script>
  <script src="./저장위치 관리_files/lodash.4.17.15.min.js.download"></script>
  <script src="./저장위치 관리_files/moment.js.download"></script>

  <script src="./저장위치 관리_files/jquery.collapse.js.download"></script>

  <script src="./저장위치 관리_files/jquery.bootstrap-touchspin.min.js.download"></script>
  <!-- bootstrap submodal -->
  <script src="./저장위치 관리_files/bs.sm.js.download"></script>

  <script src="./저장위치 관리_files/xlsx.full.min.js.download"></script>
  <script src="./저장위치 관리_files/fileSaver.min.js.download"></script>
  <script src="./저장위치 관리_files/toastr.min.js.download"></script>

  <script src="./저장위치 관리_files/jquery.mask.js.download"></script>

  <script src="./저장위치 관리_files/ag-grid-enterprise.min.noStyle.js.download"></script>
  <script>
    agGrid.LicenseManager.setLicenseKey(
      "CompanyName=JSIT,LicensedGroup=HANSOL PNS IT-SERVICE,LicenseType=MultipleApplications,LicensedConcurrentDeveloperCount=3,LicensedProductionInstancesCount=2,AssetReference=AG-008218,ExpiryDate=21_May_2021_[v2]_MTYyMTU1MTYwMDAwMA==fb098f15da774457685846b99c4a3a7e"
    );
  </script>
  <script src="./저장위치 관리_files/ag_base.js.download"></script>
  <script src="./저장위치 관리_files/ag_locale_ko.js.download"></script>
  <script src="./저장위치 관리_files/ag_renderer.js.download"></script>
  <script src="./저장위치 관리_files/ag_formatter.js.download"></script>
  <script src="./저장위치 관리_files/ag_editor.js.download"></script>
  <script src="./저장위치 관리_files/ag_excel.js.download"></script>

  <!-- CK Editor -->
  <!-- ============================================================== -->
  <script src="./저장위치 관리_files/ckeditor.js.download"></script>
  <style>
    .cke {
      visibility: hidden;
    }

    /* Make approval grid text smaller */
    #approvalGrid .ag-cell {
      font-size: 13px !important;
    }
  </style>

  <script src="./저장위치 관리_files/pine.js.download"></script>
  <script src="./저장위치 관리_files/global-val.js.download"></script>
  <script src="./저장위치 관리_files/core.js.download"></script>
  <script src="./저장위치 관리_files/file.js.download"></script>
  <script src="./저장위치 관리_files/auth.js.download"></script>
  <script src="./저장위치 관리_files/editor.js.download"></script>
  <script src="./저장위치 관리_files/aggridHelper.js.download"></script>

  <!-- ============================================================== -->

  <script src="./저장위치 관리_files/doc_ready.js.download"></script>
</head>

<body class="fix-header card-no-border main">
  <div class="preloader" style="display: none">
    <div class="loader">
      <div class="loader__figure"></div>
      <p class="loader__label">Harmony</p>
    </div>
  </div>

  <div id="main-wrapper">
    <header class="topbar">
      <nav class="navbar top-navbar navbar-expand-md navbar-light">
        <div class="navbar-header">
          <a class="navbar-brand">
            <b>
              <img src="./저장위치 관리_files/logo-icon.png" alt="homepage" class="dark-logo" />

              <img src="./저장위치 관리_files/logo-light-icon.png" alt="homepage" class="light-logo" />
            </b>

            <span>
              <img src="./저장위치 관리_files/logo-text.png" alt="homepage" class="dark-logo" />

              <img src="./저장위치 관리_files/logo-light-text.png" class="light-logo" alt="homepage" /></span>
          </a>
        </div>

        <div class="navbar-collapse">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item">đọ
              <a class="nav-link nav-toggler hidden-md-up waves-effect waves-dark" href="javascript:void(0)"><i
                  class="ti-menu"></i></a>
            </li>
            <li class="nav-item">
              <a class="nav-link sidebartoggler hidden-sm-down waves-effect waves-dark" href="javascript:void(0)"><i
                  class="fa-solid fa-bars"></i></a>
            </li>
          </ul>

          <ul class="navbar-nav my-lg-0">
            <li class="nav-item">
              <a class="nav-link" href="javascript:void(0)">
                <span style="font-weight: bold; font-size: 18px">dev서버</span>
              </a>
            </li>

            <li class="nav-item hidden-xs-down search-box">
              <a class="nav-link hidden-sm-down waves-effect waves-dark" href="javascript:void(0)" title="메뉴 검색"><i
                  class="ti-search"></i></a>
              <form class="app-search" onsubmit="return false">
                <input type="text" id="menu-search-txt" class="form-control" placeholder="메뉴 검색" />
                <a class="srh-btn"><i class="ti-close"></i></a>
                <div id="menu-search" class="search-rslt"></div>
              </form>
            </li>

            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle waves-effect waves-dark" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false">
                <span>시스템관리</span>
              </a>
              <div class="dropdown-menu dropdown-menu-right animated flipInY">
                <ul class="dropdown-user">
                  <li>
                    <div class="dw-user-box">
                      <div class="u-text">
                        <h4>
                          <i class="fas fa-user"></i>&nbsp;
                          <span>시스템관리</span>
                        </h4>
                        <p class="text-muted"><span></span></p>
                      </div>
                    </div>
                  </li>
                  <li role="separator" class="divider"></li>
                  <li>
                    <a><i class="ti-settings"></i> 계정설정</a>
                  </li>
                  <li role="separator" class="divider"></li>
                  <li>
                    <a><i class="fa fa-power-off"></i> 로그아웃</a>
                  </li>
                </ul>
              </div>
            </li>
          </ul>
        </div>
      </nav>
    </header>
    <aside class="left-sidebar">
      <div class="scroll-sidebar ps-container ps-theme-default" data-ps-id="6445c0c0-d75d-a3cd-4fab-49cc73438c65">
        <nav class="sidebar-nav active">
          <ul id="sidebarnav" class="in">
            <li class="nav-small-cap">즐겨찾기 ★</li>
            <ul class="list-group" id="sidebarnav-favorite"></ul>
            <li class="nav-devider"></li>

            <li class="nav-small-cap">프로그램</li>

            <li class="active">
              <a class="has-arrow waves-effect waves-dark" aria-expanded="true">
                <i class="mdi mdi-format-list-bulleted"></i>
                <span class="hide-menu">Request</span>
              </a>

              <ul aria-expanded="true" class="collapse in show">
                <li style="margin-left: 14px;">
                  <a class=" waves-effect waves-dark" href="./request_popup.html" style="color: #007bff;">Popup Request
                    Demo</a>
                </li>
                <li style="margin-left: 14px;">
                  <a class=" waves-effect waves-dark" href="./request_listing.html">Request listing Demo</a>
                </li>

              </ul>
            </li>
          </ul>
        </nav>
        <div class="ps-scrollbar-x-rail" style="left: 0px; bottom: 0px">
          <div class="ps-scrollbar-x" tabindex="0" style="left: 0px; width: 0px"></div>
        </div>
        <div class="ps-scrollbar-y-rail" style="top: 0px; right: 3px">
          <div class="ps-scrollbar-y" tabindex="0" style="top: 0px; height: 0px"></div>
        </div>
      </div>
    </aside>

    <div class="page-wrapper" style="min-height: 952px">
      <div class="container-fluid r-aside">
        <div class="row page-titles m-b-10">
          <div class="col-md-5 align-self-center">
            <!-- <h4 class="text-themecolor"><i class="fas fa-sticky-note pageIcon"></i><span id="pageTitles">HOME</span></h3> -->
            <!-- <h6 class="text-themecolor" id="pageTitleText">HOME</h5> -->
            <li id="pageTitleText">
              Popup Request Demo<i class="fa-regular fa-star" style="
                    font-size: 16px !important;
                    font-weight: bold !important;
                    margin-left: 5px;
                  " data-favo="N"></i>
            </li>
          </div>
        </div>

        <div class="toolbar">
          <div class="toolbar-right">
            <button id="btn-new" class="btn btn-harmony-blue btn-sm">
              <i class="fa fa-plus"></i> Request
            </button>

          </div>
          <div class="after-floatright"></div>
        </div>

        <!-- SECTION Filter collapse -->
        <div class="card" style="margin-bottom: 0px;" data-collapse="">
          <div class="card-header field-header open" data-collapse-summary="" aria-expanded="true">
            <a>
              <a class="card-link" aria-expanded="true" aria-controls="cardBody">검색조건
                <span class="expanded">
                  <p><b>▼</b></p>
                </span>
              </a>
            </a>
          </div>
          <div id="cardBody" class="collapse show field-body" aria-hidden="false">
            <div class="card-body">
            </div>
          </div>
        </div>

        <div class="learn-quickfilter d-flex justify-content-between align-items-center mb-1"
          style="background: #f7f9fb; padding: 5px 0; border-radius: 8px">
        </div>

        <!-- Table Here -->


        <!-- Second filter -->



      </div>


      <!-- End fixed bottom info bar -->

      <footer class="footer text-center">© 2025 Harmony by HansolPNS</footer>
    </div>
    <!-- Fixed bottom info bar -->

  </div> <!-- page-wrapper -->
  </div> <!-- main-wrapper -->

  <input type="hidden" id="spring_profile" value="dev" />
  <input type="hidden" id="loginUserId" value="marusys" />
  <input type="hidden" id="session_USER_ID" value="marusys" />
  <input type="hidden" id="session_USER_NM" value="시스템관리" />
  <input type="hidden" id="session_MANDT" value="100" />
  <input type="hidden" id="session_MANDT_NM" value="지류유통" />
  <input type="hidden" id="session_BUKRS" value="M200" />
  <input type="hidden" id="session_BUKRS_NM" value="PNS지류유통" />
  <input type="hidden" id="session_VKGRP" value="" />
  <input type="hidden" id="session_VKGRP_NM" value="" />
  <input type="hidden" id="session_MOBILE" value="" />
  <input type="hidden" id="session_EMAIL" value="" />
  <input type="hidden" id="session_KOSTL" value="" />
  <input type="hidden" id="session_ADMIN_YN" value="N" />
  <input type="hidden" id="session_LOGIN_DT" value="2025-07-15 19:30:24" />
  <input type="hidden" id="session_SMART_ID" value="" />
  <input type="hidden" id="session_SMART_PASSWORD" value="" />
  <input type="hidden" id="session_USER_IP" value="0:0:0:0:0:0:0:1" />
  <input type="hidden" id="session_SESSION_ID" value="" />
  <input type="hidden" id="session_FIRST_TOPMENU" value="" />
  <input type="hidden" id="session_MM" value="MM999" />
  <input type="hidden" id="session_SD" value="SD999" />
  <input type="hidden" id="session_CO" value="CO999" />
  <input type="hidden" id="session_FI" value="FI999" />
  <input type="hidden" id="session_CM" value="CM999" />
  <input type="hidden" id="session_IN_IP_YN" value="N" />
  <input type="hidden" id="session_UPPER_BU" value="" />
  <input type="hidden" id="session_UPPER_NAME" value="" />

  <input id="message" type="hidden" value="" />

  <!-- Modal Request Popup -->
  <div class="modal fade" id="requestModal" tabindex="-1" role="dialog" aria-labelledby="requestModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-xl" style="width: 1000px;" role="document">
      <div id="requestForm" class="modal-content" style="border-radius: 16px; overflow: hidden;">
        <div class="modal-header" style="border-bottom: 1px solid #f0f0f0;">
          <h5 class="modal-title" id="requestModalLabel"><i class="fa fa-paper-plane"></i> 품의 상신 </h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" style="background: #f7f9fb; padding: 0px;">


          <div style="background: #fff;  padding: 12px 24px 12px 24px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
              <div style=" display: flex; align-items: center; gap: 16px;">
                <div
                  style="width: 50px; height: 50px; background: #e3e7ed; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; font-weight: bold; color: #4a5568;">
                  <span id="userAvatar">김</span>
                </div>
                <div>
                  <div style="font-size: 18px; font-weight: bold; color: #222;" id="userName">김철수</div>
                  <div style="font-size: 13px; color: #666;">조직: <span id="userDept">웹팀</span></div>

                </div>

              </div>


              <div>
                <div style="font-size: 13px; color: #666; margin-top: 4px;">요청일시: <span id="userDate">2025/07/21 16:23
                  </span>
                </div>
                <div style="float: right; display: flex; gap: 5px;">
                  <div for="priority" style="font-size: 13px; color: #666; margin-top: 4px;">우선순위:</div>
                  <select id="priority" name="priority"
                    style="padding: 0px 12px; border-radius: 5px; border: 1px solid #e3e7ed; font-size: 15px; font-weight: 500; background: #f7f9fb; color: #222; outline: none; appearance: none; position: relative; margin-bottom: 0;">
                    <option value="low" data-color="#38b2ac">낮음</option>
                    <option value="medium" data-color="#f6ad55">보통</option>
                    <option value="high" data-color="#f56565">높음</option>
                    <option value="urgent" data-color="#e53e3e">긴급</option>
                  </select>
                </div>

              </div>

            </div>

            <!-- 결재자 -->


            <!-- 제목, 내용, 우선순위, 부서, 첨부파일 -->
            <div class="form-group">
              <label for="title" style="font-size: 14px; font-weight: bold;">제목 <span style="color:red">*</span></label>
              <input type="text" class="form-control form-control-sm" id="title" name="title" placeholder="요청 제목을 입력하세요"
                required>
            </div>
            <div class="form-group">
              <label for="content" style="font-size: 14px; font-weight: bold;">내용 <span
                  style="color:red">*</span></label>
              <textarea class="form-control form-control-sm" id="content" name="content" rows="3"
                placeholder="요청 내용을 입력하세요" required></textarea>
            </div>
            <!-- 첨부파일 (드래그 앤 드롭 유지) -->
            <!-- <div class="form-group">
              <label for="attachment" style="font-size: 14px; font-weight: bold;">첨부파일</label>
              <div id="drop-area"
                style="border: 2px dashed #bdbdbd; border-radius: 12px; background: #fff; padding: 32px 0; text-align: center; margin-top: 8px; margin-bottom: 8px; cursor: pointer; transition: border-color 0.2s;">
                <span style="font-size: 16px; color: #444;">여기로 파일을 끌어다 놓거나 <span id="browseFile"
                    style="color: #2563eb; text-decoration: underline; cursor: pointer;">파일 선택</span></span>
                <div style="font-size: 12px; color: #888; margin-top: 8px;">최대 크기: 5MB (PDF, DOCX, XLSX, JPG, PNG 지원)
                </div>
                <input type="file" id="attachment" name="attachment" style="display: none;"
                  accept=".pdf,.docx,.xlsx,.jpg,.jpeg,.png" />
              </div>
            </div> -->

            <div>
              <!-- approve line here  -->
              <div>
                <!-- Approval Line Component -->
                <div class="approval-line-wrap" style="margin-top:18px;">
                  <div class="d-flex align-items-center mb-2" style="gap:12px; justify-content: space-between; ">
                    <div>
                      <button id="applyDefaultLine" class="btn btn-harmony-blue btn-sm"><i class="fa fa-sync"></i> 기존
                        결재선 적용 </button>
                      <button id="saveDefaultLine" class="btn btn-outline-secondary btn-sm"><i class="fa fa-save"></i>
                        결재선 저장</button>

                    </div>
                    <div style="display: flex; align-items: center; gap: 12px;">
                      <!-- <div class="form-check form-switch ml-2">
                        <input class="form-check-input" type="checkbox" id="parallelApproval" style="display: none;">
                        <label class="form-check-label" for="parallelApproval" style="font-size:14px;">병렬 결재</label>

                      </div> -->
                      <button id="addApprovalRow" class="btn btn-outline-primary btn-sm"
                        style="border-radius:50%;width:32px;height:32px;display:flex;align-items:center;justify-content:center;font-size:18px;border:none;"><i
                          class="fa fa-plus"></i></button>

                    </div>


                  </div>
                  <div id="approvalGrid" class="ag-theme-balham"
                    style="height: 300px; width: 100%; background: #fff; border-radius: 12px; box-shadow:0 1px 8px #0001; font-size:15px;">
                  </div>

                  <!-- User Search Popup -->
                  <div id="userSearchModal" class="modal" tabindex="-1" role="dialog">
                    <div class="modal-dialog" role="document">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title"><i class="fa fa-search"></i> 결재자 검색</h5>
                          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                              aria-hidden="true">&times;</span></button>
                        </div>
                        <div class="modal-body">
                          <input type="text" id="userSearchInput" class="form-control mb-2"
                            placeholder="이름, 아이디, 직책으로 검색..." style="border:none;box-shadow:none;">
                          <div id="userSearchList"></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>
            <div class="modal-footer" style="border-top: 1px solid #f0f0f0;">
              <button type="submit" class="btn btn-harmony-blue btn-sm"><i class="fa fa-paper-plane"></i> 상신</button>
            </div>
            </form>
          </div>
        </div>

        <script>
          $(document).ready(function () {
            // Mở popup khi bấm nút Request
            $('#btn-new').on('click', function () {
              $('#requestModal').modal('show');
            });
            // Validate và submit form
            $('#requestForm').on('submit', function (e) {
              e.preventDefault();
              if (!$('#title').val() || !$('#content').val()) {
                toastr.warning('Vui lòng nhập đầy đủ thông tin bắt buộc!');
                return;
              }
              toastr.success('Yêu cầu đã được gửi!');
              $('#requestModal').modal('hide');
              this.reset();
            });
          });
        </script>
        <script>
          $(document).ready(function () {
            // Approval Line Component
            const mockUsers = [
              { id: 'u001', name: '김철수', title: '팀장', dept: '웹팀' },
              { id: 'u002', name: '박민수', title: '과장', dept: '영업팀' },
              { id: 'u003', name: '이영희', title: '대리', dept: '기획팀' },
              { id: 'u004', name: '최지훈', title: '사원', dept: '개발팀' },
              { id: 'u005', name: '정수진', title: '부장', dept: '인사팀' },
              { id: 'u006', name: '조현우', title: '팀장', dept: '마케팅팀' },
              { id: 'u007', name: '한지민', title: '과장', dept: '재무팀' },
              { id: 'u008', name: '윤아름', title: '대리', dept: '운영팀' },
              { id: 'u009', name: '오세훈', title: '사원', dept: '고객지원' },
              { id: 'u010', name: '신동엽', title: '부장', dept: '기술팀' }
            ];
            const lineTypes = [
              { value: '기안', label: '기안' },
              { value: '결재', label: '결재' },
              { value: '병렬결재', label: '병렬결재' },
              { value: '합의', label: '합의' },
              { value: '병렬합의', label: '병렬합의' },
              { value: '통보', label: '통보' },
              { value: '확정', label: '확정' }
            ];
            const defaultLine = [
              { order: 0, type: '기안', user: mockUsers[0], dept: mockUsers[0].dept }
            ];
            let approvalLine = JSON.parse(JSON.stringify(defaultLine));
            let approvalGridApi = null;
            const approvalColumnDefs = [
              {
                headerName: '순번',
                field: 'order',
                minWidth: 60,
                flex: 1,
                valueGetter: params => params.node.rowIndex,
                cellClass: 'ag-center-cell',
                suppressMenu: true
              },
              {
                headerName: '유형',
                field: 'type',
                minWidth: 100,
                flex: 2,
                cellRenderer: params => {
                  const options = lineTypes.map(t => `<option value='${t.value}' ${params.value === t.value ? 'selected' : ''}>${t.label}</option>`).join('');
                  return `<select class='form-control form-control-sm approval-type-select' style='border:none;box-shadow:none;height:36px;text-align:center;'>${options}</select>`;
                },
                editable: true,
                cellClass: 'ag-center-cell'
              },
              {
                headerName: '결재자',
                field: 'user',
                minWidth: 180,
                flex: 3,
                cellRenderer: params => {
                  const user = params.value;
                  let display = user ? `${user.name} (${user.title}) [${user.id}]` : '';
                  return `<div style='display:flex;align-items:center;gap:6px;height:36px;'>
          <input type='text' class='form-control form-control-sm approval-user-input' value='${display}' readonly style='background:#f7f9fb;width:120px;border:none;box-shadow:none;height:36px;text-align:center;'>
          <button class='btn btn-outline-secondary btn-sm search-user-btn' title='검색' style='border:none;height:36px;'><i class='fa fa-search'></i></button>
        </div>`;
                },
                editable: false,
                cellClass: 'ag-center-cell'
              },
              {
                headerName: '직책',
                field: 'user.title',
                minWidth: 100,
                flex: 2,
                valueGetter: params => params.data.user ? params.data.user.title : '',
                cellClass: 'ag-center-cell',
                editable: false
              },
              {
                headerName: '부서',
                field: 'dept',
                minWidth: 120,
                flex: 2,
                cellRenderer: params => `<input type='text' class='form-control form-control-sm approval-dept-input' value='${params.value || ''}' style='background:#f7f9fb;border:none;box-shadow:none;height:36px;text-align:center;'>`,
                editable: true,
                cellClass: 'ag-center-cell'
              },
              {
                headerName: '',
                field: 'actions',
                minWidth: 120,
                flex: 2,
                cellRenderer: params => {
                  return `<div style='display:flex;align-items:center;gap:4px;justify-content:flex-end;height:36px;'>
          <i class='fa fa-trash' style="color: red"></i>
          <button class='btn btn-outline-dark btn-sm move-up-btn' title='위로' style='border:none;height:36px;'><i class='fa fa-arrow-up'></i></button>
          <button class='btn btn-outline-dark btn-sm move-down-btn' title='아래로' style='border:none;height:36px;'><i class='fa fa-arrow-down'></i></button>
        </div>`;
                },
                suppressMenu: true,
                suppressSorting: true,
                cellClass: 'ag-center-cell'
              }
            ];
            const approvalGridOptions = {
              columnDefs: approvalColumnDefs,
              rowData: approvalLine,
              defaultColDef: {
                resizable: true,
                sortable: false,
                filter: false,
                editable: false,
                minWidth: 60,
                flex: 1,
                cellClass: 'ag-center-cell',
                cellStyle: { display: 'flex', alignItems: 'center', justifyContent: 'center', height: '100%' }
              },
              suppressRowClickSelection: true,
              rowSelection: 'single',
              animateRows: true,
              getRowHeight: function (params) {
                return 52;
              },
              onGridReady: function (params) {
                approvalGridApi = params.api;
              },
              onCellClicked: function (params) {
                const rowIdx = params.node.rowIndex;
                if (params.colDef.field === 'add') {
                  addApprovalRow(rowIdx + 1);
                }
              },
              onCellEditingStopped: function (params) {
                // ...handle cell edit if needed...
              }
            };
            new agGrid.Grid(document.getElementById('approvalGrid'), approvalGridOptions);
            function addApprovalRow(idx) {
              approvalLine.splice(idx, 0, { order: idx, type: '결재', user: null, dept: '' });
              refreshApprovalGrid();
            }
            $('#addApprovalRow').on('click', function () {
              addApprovalRow(approvalLine.length);
            });
            $(document).on('click', '.remove-row-btn', function () {
              const idx = getRowIndexFromBtn(this);
              if (idx !== null) {
                approvalLine.splice(idx, 1);
                refreshApprovalGrid();
              }
            });
            $(document).on('click', '.move-up-btn', function () {
              const idx = getRowIndexFromBtn(this);
              if (idx > 0) {
                [approvalLine[idx - 1], approvalLine[idx]] = [approvalLine[idx], approvalLine[idx - 1]];
                refreshApprovalGrid();
              }
            });
            $(document).on('click', '.move-down-btn', function () {
              const idx = getRowIndexFromBtn(this);
              if (idx < approvalLine.length - 1) {
                [approvalLine[idx + 1], approvalLine[idx]] = [approvalLine[idx], approvalLine[idx + 1]];
                refreshApprovalGrid();
              }
            });
            $(document).on('change', '.approval-type-select', function () {
              const idx = getRowIndexFromBtn(this);
              if (idx !== null) {
                approvalLine[idx].type = $(this).val();
                refreshApprovalGrid();
              }
            });
            $(document).on('change', '.approval-dept-input', function () {
              const idx = getRowIndexFromBtn(this);
              if (idx !== null) {
                approvalLine[idx].dept = $(this).val();
              }
            });
            $(document).on('click', '.search-user-btn', function () {
              const idx = getRowIndexFromBtn(this);
              $('#userSearchModal').data('rowIdx', idx).modal('show');
              renderUserSearchList('');
              $('#userSearchInput').val('');
            });
            $('#userSearchInput').on('input', function () {
              renderUserSearchList($(this).val());
            });
            $(document).on('click', '.user-search-item', function () {
              const idx = $('#userSearchModal').data('rowIdx');
              const userId = $(this).data('userid');
              const user = mockUsers.find(u => u.id === userId);
              if (user && idx !== null) {
                approvalLine[idx].user = user;
                approvalLine[idx].dept = user.dept;
                refreshApprovalGrid();
                $('#userSearchModal').modal('hide');
              }
            });
            $('#applyDefaultLine').on('click', function () {
              approvalLine = JSON.parse(JSON.stringify(defaultLine));
              refreshApprovalGrid();
            });
            $('#saveDefaultLine').on('click', function () {
              toastr.success('현재 결재선을 저장했습니다!');
            });
            $('#parallelApproval').on('change', function () {
              if (this.checked) {
                toastr.info('병렬 결재로 변경되었습니다!');
              } else {
                toastr.info('순차 결재로 변경되었습니다!');
              }
            });
            function getRowIndexFromBtn(btn) {
              const $row = $(btn).closest('.ag-row');
              if ($row.length) {
                return parseInt($row.attr('row-index'));
              }
              const val = $(btn).closest('div').find('input.approval-user-input').val();
              return approvalLine.findIndex(r => r.user && `${r.user.name} (${r.user.title}) [${r.user.id}]` === val);
            }
            function refreshApprovalGrid() {
              approvalGridApi.setRowData(approvalLine);
              approvalGridApi.redrawRows();
            }
            function renderUserSearchList(keyword) {
              let list = mockUsers.filter(u => {
                if (!keyword) return true;
                keyword = keyword.toLowerCase();
                return u.id.toLowerCase().includes(keyword) || u.name.toLowerCase().includes(keyword) || u.title.toLowerCase().includes(keyword);
              });
              $('#userSearchList').html(list.map(u =>
                `<div class='user-search-item' data-userid='${u.id}' style='padding:8px 12px;cursor:pointer;border-bottom:1px solid #f0f0f0;'>
        <b>${u.name}</b> <span style='color:#888;'>(${u.title})</span> <span style='color:#2563eb;'>[${u.id}]</span> <span style='color:#aaa;'>${u.dept}</span>
      </div>`
              ).join(''));
            }
          });
        </script>
</body>

</html>